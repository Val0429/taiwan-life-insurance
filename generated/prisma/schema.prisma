//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

generator markdown {
  provider = "prisma-markdown"
  output   = "./../packages/ERD.md"
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 管理台銀使用者帳號
///
/// 所有權限皆可修改自己的密碼
/// Admin 可以新建/修改/刪除帳號，與提出修改密碼請求
/// 可以刪除與停用。所有資料表惟有User可刪除
model User {
  id              String   @id() @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt()
  /// 使用者名稱
  username        String   @unique()
  /// 使用者密碼
  password        String
  /// Admin (系統管理者) / Operator (作業人員) / Reviewer (審核人員)
  role1           String
  /// Admin (系統管理者) / Operator (作業人員) / Reviewer (審核人員)
  role2           String?
  /// 0x00000000. 資產管理作業 / 租賃管理作業 / 設施設備修繕採購作業 / 會計帳務管理作業 / 事務管理作業 / 決策支援及報表作業 / 系統維護管理作業
  role1Permission Int?
  /// 0x00000000. 資產管理作業 / 租賃管理作業 / 設施設備修繕採購作業 / 會計帳務管理作業 / 事務管理作業 / 決策支援及報表作業 / 系統維護管理作業
  role2Permission Int?
  /// 真實姓名或法人名稱
  name            String
  /// Email通知消息時使用
  email           String?
  /// 其他備註
  description     String?
  /// 是否停用
  recycled        Boolean  @default(false)
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 日誌
/// additional param: context, action, err
/// userId, auditerId, relatedId
model Logs {
  id        Int      @id() @default(autoincrement())
  level     String   @db.NVarChar(Max)
  log       String   @db.NVarChar(Max)
  service   String   @db.VarChar(200)
  /// 例: ApiLogger
  context   String?  @db.VarChar(200)
  /// 例: POST /auth/login
  action    String?  @db.VarChar(200)
  message   String?  @db.NVarChar(Max)
  exception String?  @db.NVarChar(Max)
  userId    String?
  auditerId String?
  relatedId String?
  timestamp DateTime @db.DateTime()
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 上傳檔案
model Files {
  id                                 String                            @id() @default(uuid())
  createdAt                          DateTime                          @default(now())
  updatedAt                          DateTime                          @updatedAt()
  fileName                           String
  fileSize                           Int
  contentType                        String
  /// 檔案存放路徑
  filePath                           String
  /// 備註
  description                        String?
  /// 是否需要權限存取
  isPublic                           Boolean?
  /// 關聯資料，回收處理使用 ///
  incomeAndExpenseDetailId           String?
  incomeAndExpenseDetail             IncomeAndExpenseDetail?           @relation(fields: [incomeAndExpenseDetailId], references: [id], onDelete: SetNull)
  propertyId                         String?
  property                           Property?                         @relation(fields: [propertyId], references: [id], onDelete: SetNull)
  propertyEquipmentId                String?
  propertyEquipment                  PropertyEquipment?                @relation(fields: [propertyEquipmentId], references: [id], onDelete: SetNull)
  propertyRentalUnitId               String?
  propertyRentalUnit                 PropertyRentalUnit?               @relation(fields: [propertyRentalUnitId], references: [id], onDelete: SetNull)
  propertyRentalContractId           String?
  propertyRentalContract             PropertyRentalContract?           @relation(fields: [propertyRentalContractId], references: [id], onDelete: SetNull)
  propertyEquipmentMaintanceDetailId String?
  propertyEquipmentMaintanceDetail   PropertyEquipmentMaintanceDetail? @relation(fields: [propertyEquipmentMaintanceDetailId], references: [id], onDelete: SetNull)
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 收入支出分類
model IncomeAndExpenseCategory {
  id                      String                    @id() @default(uuid())
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt()
  /// 收入 (Income) 或支出 (Expense)
  type                    String
  /// 收支類別名稱，例如: 電費
  name                    String
  /// 收支類別詳細說明
  description             String?
  /// 循環週期。格式: Linux Crontab Syntax
  loopPeriod              String?
  /// 是否為出廠預設類別。預設則不可刪除
  isDefault               Boolean                   @default(false)
  /// 擁有那些主體
  incomeAndExpenseSubject IncomeAndExpenseSubject[]
  /// 是否回收 (D)
  recycled                Boolean                   @default(false)
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 在資產或出租合約中，實際代表可收支項目，可執行的主體
model IncomeAndExpenseSubject {
  id                               String                         @id() @default(uuid())
  createdAt                        DateTime                       @default(now())
  updatedAt                        DateTime                       @updatedAt()
  /// 關連到哪一個 收支項目類別
  categoryId                       String
  category                         IncomeAndExpenseCategory       @relation(fields: [categoryId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 額外詳細說明
  description                      String?
  /// 覆蓋循環週期。格式: Linux Crontab Syntax
  loopPeriod                       String?
  /// 循環年限
  loopLife                         Float?
  /// 擁有那些收支明細
  incomeAndExpenseDetail           IncomeAndExpenseDetail[]
  /// 屬於哪個資產
  propertyId                       String
  property                         Property                       @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個資產出租合約
  propertyRentalContractId         String
  propertyRentalContract           PropertyRentalContract         @relation(fields: [propertyRentalContractId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個設備維修請求
  propertyEquipmentRepairRequestId String
  propertyEquipmentRepairRequest   PropertyEquipmentRepairRequest @relation(fields: [propertyEquipmentRepairRequestId], references: [id], onUpdate: NoAction, onDelete: NoAction)
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 代表一期帳單支付，或收入入帳
model IncomeAndExpenseDetail {
  id                        String                  @id() @default(uuid())
  createdAt                 DateTime                @default(now())
  updatedAt                 DateTime                @updatedAt()
  /// 金額。單位: 新台幣
  amount                    Int
  /// 額外詳細說明
  description               String?
  /// 實際繳納日期
  executionDate             DateTime?
  /// 單據掃描檔
  files                     Files[]
  /// 自動建立後，即進入待處理狀態。直至填寫完畢
  isPending                 Boolean
  /// 屬於哪個收支項目主體
  incomeAndExpenseSubjectId String
  incomeAndExpenseSubject   IncomeAndExpenseSubject @relation(fields: [incomeAndExpenseSubjectId], references: [id], onUpdate: NoAction, onDelete: NoAction)
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 在設備中，實際代表定期保養項目，可執行的主體
model PropertyEquipmentMaintanceSubject {
  id                                 String                             @id() @default(uuid())
  createdAt                          DateTime                           @default(now())
  updatedAt                          DateTime                           @updatedAt()
  /// 循環週期。格式: Linux Crontab Syntax
  loopPeriod                         String?
  /// 額外保養詳細內容
  description                        String?
  /// 擁有哪些保養明細
  propertyEquipmentMaintanceDetail   PropertyEquipmentMaintanceDetail[]
  /// 屬於哪項設備
  propertyEquipment                  PropertyEquipment?
  /// 屬於哪個維護廠商
  propertyEquipmentMaintanceVendorId String
  propertyEquipmentMaintanceVendor   PropertyEquipmentMaintanceVendor   @relation(fields: [propertyEquipmentMaintanceVendorId], references: [id], onUpdate: NoAction, onDelete: NoAction)
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 代表一期定期保養
model PropertyEquipmentMaintanceDetail {
  id                                  String                            @id() @default(uuid())
  createdAt                           DateTime                          @default(now())
  updatedAt                           DateTime                          @updatedAt()
  /// 額外詳細說明
  description                         String?
  /// 實際執行日期
  executionDate                       DateTime?
  /// 保養紀錄單
  files                               Files[]
  /// 自動建立後，即進入待處理狀態。直至填寫完畢
  isPending                           Boolean
  /// 屬於哪個設備定期保養主體
  propertyEquipmentMaintanceSubjectId String
  propertyEquipmentMaintanceSubject   PropertyEquipmentMaintanceSubject @relation(fields: [propertyEquipmentMaintanceSubjectId], references: [id], onUpdate: NoAction, onDelete: NoAction)
}

///
/// @namespace 資產管理作業
///
/// 資產群組
///
/// 可作為受審核主體
/// 審核過程存入Logs
/// 審核過程與紀錄
/// 1: 提交審核: userId (提交人) / tenantId (PropertyGroupId) / relatedId
/// 2: 接受或駁回審核: userId (提交人) / tenantId (PropertyGroupId) / relatedId (審核人) / message (接受或駁回訊息)
model PropertyGroup {
  id            String         @id() @default(uuid())
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt()
  /// 資產群組類別: 投資用 (Investment) 自用 (Own)
  type          String
  /// 資產狀態: 持有中 (Holding) 已售出 (Sold)
  status        String         @default("Holding")
  /// 資產群組名稱。例: 葉財記大樓
  name          String
  /// 群組內關聯資產
  properties    Property[]
  /// 資料已被刪除、或審核完成
  recycled      Boolean        @default(false)
  /// 是否為審核相關資料
  auditee       Boolean
  /// 審核類別: 新增 / 修改 / 刪除
  auditType     String?
  /// 描述修改內容: 用來提示審核員，我修改了什麼?
  auditDescribe String?
  /// 審核資料父層
  auditParentId String?        @unique()
  auditParent   PropertyGroup? @relation("audit", fields: [auditParentId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 審核資料子層
  auditChild    PropertyGroup? @relation("audit")
}

/// @@allow('all', true)
///
/// @namespace 資產管理作業
///
/// 資產
model Property {
  id                              String                            @id() @default(uuid())
  createdAt                       DateTime                          @default(now())
  updatedAt                       DateTime                          @updatedAt()
  /// 資產狀態: 持有中 (Holding) 已售出 (Complete)
  status                          String                            @default("Holding")
  /// 建物類別: Land / Building
  type                            String
  /// 建物地址。例: 台北市大安區通化段五小段492地號
  address                         String
  /// 建物面積(平方公尺)。例: 608.00
  area                            Float
  /// 取得年月日
  acquireDate                     DateTime
  /// 帳面金額
  amount                          Int
  /// Building: 折舊率
  depreciationRate                Float?
  /// Building: 折舊年限。單位: 年
  depreciationLife                Float?
  /// MSSQL 不能使用 String[], 存入JSON Array File ID
  /// 1. (PropertyRights) 地籍產權資料，如土地謄本、建物謄本、地籍圖、建物測量成果圖等
  /// 2. (PropertyUsageLicense) 建築執照及使用執照等資料，如執照存根、使照竣工圖等
  /// 4. (IndoorDecoration) 室內裝修相關圖說資料，如室內裝修合格證明、竣工圖說等
  /// 5. (Others) 相關資料如有書面文件均須有掃描檔案儲存功能
  files                           Files[]
  incomeAndExpenseSubject         IncomeAndExpenseSubject[]
  /// 屬於哪個資產群組
  propertyGroupId                 String
  propertyGroup                   PropertyGroup                     @relation(fields: [propertyGroupId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 擁有哪些資產設備
  propertyEquipments              PropertyEquipment[]
  /// 擁有哪些資產空間
  propertyRentalUnits             PropertyRentalUnit[]
  /// 擁有哪些零件庫存
  propertyEquipmentPartsInventory PropertyEquipmentPartsInventory[]
  /// 資料已被刪除、或審核完成
  recycled                        Boolean                           @default(false)
  /// 是否為審核相關資料
  auditee                         Boolean
}

/// @@allow('all', true)
///
/// @namespace 資產管理作業
///
/// 資產所屬設備
model PropertyEquipment {
  id                                  String                            @id() @default(uuid())
  createdAt                           DateTime                          @default(now())
  updatedAt                           DateTime                          @updatedAt()
  /// 設備編號
  serial                              String
  /// 設備名稱
  name                                String
  /// 詳細描述
  description                         String
  /// 取得年月日
  acquireDate                         DateTime
  /// 設備保養主體
  propertyEquipmentMaintanceSubjectId String                            @unique()
  propertyEquipmentMaintanceSubject   PropertyEquipmentMaintanceSubject @relation(fields: [propertyEquipmentMaintanceSubjectId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// MSSQL 不能使用 String[], 存入JSON Array File ID
  /// 5. 相關檔案資料
  files                               Files[]
  /// 屬於哪個資產
  propertyId                          String
  property                            Property                          @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個資產空間
  propertyRentalUnitId                String?
  propertyRentalUnit                  PropertyRentalUnit?               @relation(fields: [propertyRentalUnitId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 擁有哪些設備維修請求
  propertyEquipmentRepairRequest      PropertyEquipmentRepairRequest[]
  /// 資料已被刪除、或審核完成
  recycled                            Boolean                           @default(false)
  /// 是否為審核相關資料
  auditee                             Boolean
}

/// @@allow('all', true)
///
/// @namespace 租賃管理作業
///
/// 資產空間。只有資產空間才可與用戶訂立合約
model PropertyRentalUnit {
  id                     String                  @id() @default(uuid())
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt()
  /// 資產空間狀態: 待處理 (Pending) 待出租 (Renting) 已出租 (Rented) 已售出 (Sold)
  status                 String                  @default("Pending")
  /// 招租地址。空置空間可不填地址
  address                String?
  /// 招租面積(平方公尺)。例: 608.00
  area                   Float
  /// 聯絡人姓名
  contactName            String
  /// 聯絡人email
  contactEmail           String
  /// 聯絡電話
  contactPhone           String
  /// 聯絡手機
  contactMobile          String
  /// 擬租租金。單位: 新台幣。空置空間可不填租金
  amount                 Int?
  /// 5. 相關資料如有書面文件均須有掃描檔案儲存功能。
  files                  Files[]
  /// 是否為出廠預設類別 (空置空間)。預設則不可刪除
  isDefault              Boolean                 @default(false)
  /// 屬於哪個資產
  propertyId             String
  property               Property                @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 擁有哪些資產設備
  propertyEquipments     PropertyEquipment[]
  /// 擁有哪個資產合約
  propertyRentalContract PropertyRentalContract?
  /// 資料已被刪除、或審核完成
  recycled               Boolean                 @default(false)
  /// 是否為審核相關資料
  auditee                Boolean
}

/// @@allow('all', true)
///
/// @namespace 租賃管理作業
///
/// 資產出租合約。只有資產空間才可與用戶訂立出租合約
/// (Fayu) 討論: 3. 租賃契約租期內維護，如租金調整、提前終止、契約內容變更、補充契約、申請租金減免等。
model PropertyRentalContract {
  id                      String                    @id() @default(uuid())
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt()
  /// 資產出租合約狀態: 已簽約 (Signed) 已續約 (Renewed) 已中斷 (Interrupted) 已完成 (Completed)
  status                  String
  /// 出租金額
  amount                  Int
  /// 總租期
  rentalPeriod            Int
  /// 出租開始日期
  rentalStartDate         DateTime
  /// 出租結束日期
  rentalEndDate           DateTime
  /// 免租金裝潢期限
  rentFreePeriod          Int
  /// 免租金裝潢截止日期
  rentFreeEndDate         DateTime
  /// 特約條款
  specialTerms            String?
  incomeAndExpenseSubject IncomeAndExpenseSubject[]
  /// 1. 承租戶簽核資料，如簽呈
  /// 2. 及其附件等
  files                   Files[]
  /// 屬於哪個資產空間
  propertyRentalUnitId    String                    @unique()
  propertyRentalUnit      PropertyRentalUnit        @relation(fields: [propertyRentalUnitId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個租戶
  customerId              String
  customer                Customer                  @relation(fields: [customerId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 資料已被刪除、或審核完成
  recycled                Boolean                   @default(false)
  /// 是否為審核相關資料
  auditee                 Boolean
}

/// @@allow('all', true)
///
/// @namespace 租賃管理作業
///
/// 租用資產客戶
model Customer {
  id                             String                           @id() @default(uuid())
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime                         @updatedAt()
  /// 客戶名稱
  username                       String                           @unique()
  /// 客戶密碼
  password                       String
  /// 真實姓名或法人名稱
  name                           String
  /// Email通知消息時使用
  email                          String
  /// 聯絡電話
  phone                          String
  /// 聯絡手機
  mobile                         String
  /// 其他備註
  description                    String?
  /// 擁有資產出租合約
  propertyRentalContract         PropertyRentalContract[]
  /// 擁有維修申請
  propertyEquipmentRepairRequest PropertyEquipmentRepairRequest[]
  /// 資料已被刪除、或審核完成
  recycled                       Boolean                          @default(false)
  /// 是否為審核相關資料
  auditee                        Boolean
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 設備維修請求
/// 申請日期即建立日期
model PropertyEquipmentRepairRequest {
  id                      String                    @id() @default(uuid())
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt()
  /// 維修狀態: 待處理 (Pending) 派工中 (Dispatched) 已完工 (Complete)
  status                  String
  /// 維修內容詳細描述
  description             String
  /// 收支: 維修費用
  incomeAndExpenseSubject IncomeAndExpenseSubject[]
  /// 維修哪個設備
  propertyEquipmentId     String
  propertyEquipment       PropertyEquipment         @relation(fields: [propertyEquipmentId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個租戶
  customerId              String
  customer                Customer                  @relation(fields: [customerId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 資料已被刪除、或審核完成
  recycled                Boolean                   @default(false)
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 設備定期保養廠商
model PropertyEquipmentMaintanceVendor {
  id                                String                              @id() @default(uuid())
  createdAt                         DateTime                            @default(now())
  updatedAt                         DateTime                            @updatedAt()
  /// 廠商統一編號
  serialNumber                      String
  /// 廠商名稱
  name                              String
  /// 廠商聯絡人
  contactName                       String
  /// 聯絡人email
  contactEmail                      String
  /// 聯絡電話
  contactPhone                      String
  /// 聯絡手機
  contactMobile                     String
  /// 廠商服務內容與詳細資料
  description                       String
  /// 負責設備保養主體
  propertyEquipmentMaintanceSubject PropertyEquipmentMaintanceSubject[]
  /// 資料已被刪除、或審核完成
  recycled                          Boolean                             @default(false)
  /// 是否為審核相關資料
  auditee                           Boolean
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 零件庫存資料
model PropertyEquipmentPartsInventory {
  id          String    @id() @default(uuid())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt()
  /// 零件名稱
  name        String
  /// 有多少
  items       Int
  /// 詳細描述
  description String
  /// 屬於哪個資產
  propertyId  String?
  property    Property? @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 資料已被刪除、或審核完成
  recycled    Boolean   @default(false)
  /// 是否為審核相關資料
  auditee     Boolean
}
