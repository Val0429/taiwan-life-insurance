//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

generator markdown {
  provider = "prisma-markdown"
  output   = "./../packages/ERD.md"
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 管理台銀使用者帳號
///
/// 所有權限皆可修改自己的密碼
/// Admin 可以新建/修改/刪除帳號，與提出修改密碼請求
model User {
  id              String   @id() @default(uuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt()
  /// 使用者名稱
  username        String   @unique()
  /// 使用者密碼
  password        String
  /// Admin (系統管理者) / Operator (作業人員) / Reviewer (審核人員)
  role1           String
  /// Admin (系統管理者) / Operator (作業人員) / Reviewer (審核人員)
  role2           String?
  /// 0x00000000. 資產管理作業 / 租賃管理作業 / 設施設備修繕採購作業 / 會計帳務管理作業 / 事務管理作業 / 決策支援及報表作業 / 系統維護管理作業
  role1Permission Int?
  /// 0x00000000. 資產管理作業 / 租賃管理作業 / 設施設備修繕採購作業 / 會計帳務管理作業 / 事務管理作業 / 決策支援及報表作業 / 系統維護管理作業
  role2Permission Int?
  /// 真實姓名或法人名稱
  name            String
  /// Email通知消息時使用
  email           String?
  /// 其他備註
  description     String?
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 日誌
model Logs {
  id        Int      @id() @default(autoincrement())
  level     String   @db.NVarChar(Max)
  log       String   @db.NVarChar(Max)
  service   String   @db.VarChar(200)
  module    String   @db.VarChar(200)
  message   String?  @db.NVarChar(Max)
  exception String?  @db.NVarChar(Max)
  userId    String?
  tenantId  String?
  relatedId String?
  timestamp DateTime @db.DateTime()
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 上傳檔案
model Files {
  id          String   @id() @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt()
  fileName    String
  fileSize    Int
  contentType String
  /// 檔案存放路徑
  filePath    String
  /// 備註
  description String?
  /// 是否需要權限存取
  isPublic    Boolean?
  /// 關聯資料，回收處理使用 ///
  used        Boolean
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 收入支出分類
model IncomeAndExpenseCategory {
  id                      String                    @id() @default(uuid())
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt()
  /// 收入 (Income) 或支出 (Expense)
  type                    String
  /// 收支類別名稱，例如: 電費
  name                    String
  /// 收支類別詳細說明
  description             String?
  /// 循環週期。格式: Linux Crontab Syntax
  loopPeriod              String?
  /// 是否為出廠預設類別
  isDefault               Boolean
  /// 擁有那些主體
  incomeAndExpenseSubject IncomeAndExpenseSubject[]
  /// 是否回收 (D)
  recycled                Boolean
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 在資產或出租合約中，實際代表可收支項目
model IncomeAndExpenseSubject {
  id                       String                   @id() @default(uuid())
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt()
  /// 關連到哪一個 收支項目類別
  categoryId               String
  category                 IncomeAndExpenseCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  /// 額外詳細說明
  description              String?
  /// 覆蓋循環週期。格式: Linux Crontab Syntax
  loopPeriod               String?
  /// 擁有那些收支明細
  incomeAndExpenseDetail   IncomeAndExpenseDetail[]
  /// 屬於哪個資產
  propertyId               String
  property                 Property                 @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個資產出租合約
  propertyRentalContractId String
  propertyRentalContract   PropertyRentalContract   @relation(fields: [propertyRentalContractId], references: [id], onUpdate: NoAction, onDelete: NoAction)
}

/// @@allow('all', true)
///
/// @namespace 系統維護管理作業
///
/// 代表一期帳單支付，或收入入帳
model IncomeAndExpenseDetail {
  id                        String                  @id() @default(uuid())
  createdAt                 DateTime                @default(now())
  updatedAt                 DateTime                @updatedAt()
  /// 金額。單位: 新台幣
  amount                    Int
  /// 額外詳細說明
  description               String?
  /// 自動建立後，即進入待處理狀態。直至填寫完畢
  isPending                 Boolean
  /// 屬於哪個收支項目主體
  incomeAndExpenseSubjectId String
  incomeAndExpenseSubject   IncomeAndExpenseSubject @relation(fields: [incomeAndExpenseSubjectId], references: [id], onDelete: Cascade)
}

///
/// @namespace 資產管理作業
///
/// 資產群組
///
/// 可作為受審核主體
/// 審核過程存入Logs
/// 審核過程與紀錄
/// 1: 提交審核: userId (提交人) / tenantId (PropertyGroupId) / relatedId
/// 2: 接受或駁回審核: userId (提交人) / tenantId (PropertyGroupId) / relatedId (審核人) / message (接受或駁回訊息)
model PropertyGroup {
  id            String         @id() @default(uuid())
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt()
  /// 資產群組名稱。例: 葉財記大樓
  name          String
  /// 群組內關聯資產
  properties    Property[]
  /// 資料已被刪除、或審核完成
  recycled      Boolean
  /// 是否為審核相關資料
  auditee       Boolean
  /// 審核類別: 新增 / 修改 / 刪除
  auditType     String?
  /// 描述修改內容: 用來提示審核員，我修改了什麼?
  auditDescribe String?
  /// 審核資料父層
  auditParentId String?        @unique()
  auditParent   PropertyGroup? @relation("audit", fields: [auditParentId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 審核資料子層
  auditChild    PropertyGroup? @relation("audit")
}

/// @@allow('all', true)
///
/// @namespace 資產管理作業
///
/// 資產
model Property {
  id                               String                             @id() @default(uuid())
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime                           @updatedAt()
  /// 建物類別: Land / Building
  type                             String
  /// 建物地址。例: 台北市大安區通化段五小段492地號
  address                          String
  /// 建物面積(平方公尺)。例: 608.00
  area                             Float
  /// 取得年月日
  acquireDate                      DateTime
  /// 帳面金額
  price                            Float
  /// MSSQL 不能使用 String[], 存入JSON Array File ID
  /// 1. 地籍產權資料，如土地謄本、建物謄本、地籍圖、建物測量成果圖等
  filesPropertyRights              String?
  /// 2. 建築執照及使用執照等資料，如執照存根、使照竣工圖等
  filesPropertyUsageLicense        String?
  /// 4. 室內裝修相關圖說資料，如室內裝修合格證明、竣工圖說等
  filesIndoorDecoration            String?
  /// 5. 相關資料如有書面文件均須有掃描檔案儲存功能
  filesOther                       String?
  incomeAndExpenseSubject          IncomeAndExpenseSubject[]
  /// 屬於哪個資產群組
  propertyGroupId                  String
  propertyGroup                    PropertyGroup                      @relation(fields: [propertyGroupId], references: [id], onDelete: Cascade)
  /// 擁有那些資產設備
  propertyEquipments               PropertyEquipment[]
  /// 擁有那些資產招租
  propertyRentalUnits              PropertyRentalUnit[]
  /// 擁有那些維修申請
  propertyEquipmentRepairRequest   PropertyEquipmentRepairRequest[]
  /// 擁有那些保養紀錄
  propertyEquipmentMaintanceRecord PropertyEquipmentMaintanceRecord[]
  /// 資料已被刪除、或審核完成
  recycled                         Boolean
  /// 是否為審核相關資料
  auditee                          Boolean
}

/// @@allow('all', true)
///
/// @namespace 資產管理作業
///
/// 資產所屬設備
model PropertyEquipment {
  id                                 String                           @id() @default(uuid())
  createdAt                          DateTime                         @default(now())
  updatedAt                          DateTime                         @updatedAt()
  /// 設備編號
  serial                             String
  /// 設備名稱
  name                               String
  /// 詳細描述
  description                        String
  /// 取得年月日
  acquireDate                        DateTime
  /// 設備保養週期 Linux Crontab Syntax
  maintainancePeriod                 String
  /// MSSQL 不能使用 String[], 存入JSON Array File ID
  /// 5. 相關檔案資料
  filesOther                         String?
  /// 屬於哪個資產
  propertyId                         String
  property                           Property                         @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個資產招租
  propertyRentalUnitId               String?
  propertyRentalUnit                 PropertyRentalUnit?              @relation(fields: [propertyRentalUnitId], references: [id], onDelete: SetNull)
  /// 屬於哪個維護廠商
  propertyEquipmentMaintanceVendorId String
  propertyEquipmentMaintanceVendor   PropertyEquipmentMaintanceVendor @relation(fields: [propertyEquipmentMaintanceVendorId], references: [id])
  /// 資料已被刪除、或審核完成
  recycled                           Boolean
  /// 是否為審核相關資料
  auditee                            Boolean
}

/// @@allow('all', true)
///
/// @namespace 租賃管理作業
///
/// 資產招租。只有資產招租才可與用戶訂立合約
model PropertyRentalUnit {
  id                     String                  @id() @default(uuid())
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt()
  /// 招租地址
  address                String
  /// 招租面積(平方公尺)。例: 608.00
  area                   Float
  /// 聯絡人姓名
  contactName            String
  /// 聯絡人email
  contactEmail           String
  /// 聯絡電話
  contactPhone           String
  /// 聯絡手機
  contactMobile          String
  /// 擬租租金。單位: 新台幣
  rentalAmount           Int
  /// 5. 相關資料如有書面文件均須有掃描檔案儲存功能。
  filesOther             String?
  /// 屬於哪個資產
  propertyId             String
  property               Property                @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  /// 擁有哪些資產設備
  propertyEquipments     PropertyEquipment[]
  /// 擁有哪個資產合約
  propertyRentalContract PropertyRentalContract?
  /// 資料已被刪除、或審核完成
  recycled               Boolean
  /// 是否為審核相關資料
  auditee                Boolean
}

/// @@allow('all', true)
///
/// @namespace 租賃管理作業
///
/// 資產出租合約。只有資產招租才可與用戶訂立出租合約
/// (Fayu) 討論: 3. 租賃契約租期內維護，如租金調整、提前終止、契約內容變更、補充契約、申請租金減免等。
model PropertyRentalContract {
  id                      String                    @id() @default(uuid())
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt()
  /// 2. 租賃契約簽訂資料: 租戶姓名
  tenantName              String
  /// 租戶email
  tenantEmail             String
  /// 租戶電話
  tenantPhone             String
  /// 租戶手機
  tenantMobile            String
  /// 出租金額
  monthlyRent             Int
  /// 總租期
  rentalPeriod            Int
  /// 出租開始日期
  rentalStartDate         DateTime
  /// 出租結束日期
  rentalEndDate           DateTime
  /// 免租金裝潢期限
  rentFreePeriod          Int
  /// 免租金裝潢截止日期
  rentFreeEndDate         DateTime
  /// 特約條款
  specialTerms            String?
  incomeAndExpenseSubject IncomeAndExpenseSubject[]
  /// 1. 承租戶簽核資料，如簽呈及其附件等。
  filesSignature          String?
  /// 屬於哪個資產招租
  propertyRentalUnitId    String                    @unique()
  propertyRentalUnit      PropertyRentalUnit        @relation(fields: [propertyRentalUnitId], references: [id], onDelete: Cascade)
  /// 屬於哪個租戶
  customerId              String
  customer                Customer                  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  /// 資料已被刪除、或審核完成
  recycled                Boolean
  /// 是否為審核相關資料
  auditee                 Boolean
}

/// @@allow('all', true)
///
/// @namespace 租賃管理作業
///
/// 租用資產客戶
model Customer {
  id                             String                           @id() @default(uuid())
  createdAt                      DateTime                         @default(now())
  updatedAt                      DateTime                         @updatedAt()
  /// 客戶名稱
  username                       String                           @unique()
  /// 客戶密碼
  password                       String
  /// 真實姓名或法人名稱
  name                           String
  /// Email通知消息時使用
  email                          String?
  /// 其他備註
  description                    String?
  /// 擁有資產出租合約
  propertyRentalContract         PropertyRentalContract[]
  /// 擁有維修申請
  propertyEquipmentRepairRequest PropertyEquipmentRepairRequest[]
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 設備維修請求
model PropertyEquipmentRepairRequest {
  id          String   @id() @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt()
  /// 申請日期
  requestDate DateTime
  /// 維修內容詳細描述
  description String
  /// 維修狀態: 待處理 派工維修 完工驗收 (?)
  status      String
  /// 維修費用
  cost        Int
  /// 屬於哪個資產
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個租戶
  customerId  String
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 設備維修請求
model PropertyEquipmentMaintanceVendor {
  id                               String                             @id() @default(uuid())
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime                           @updatedAt()
  /// 廠商統一編號
  serialNumber                     String
  /// 廠商名稱
  name                             String
  /// 廠商聯絡人
  contactName                      String
  /// 聯絡人email
  contactEmail                     String
  /// 聯絡電話
  contactPhone                     String
  /// 聯絡手機
  contactMobile                    String
  /// 廠商服務內容與詳細資料
  description                      String
  /// 負責保養設備
  propertyEquipments               PropertyEquipment[]
  /// 擁有設備保養紀錄
  propertyEquipmentMaintanceRecord PropertyEquipmentMaintanceRecord[]
}

/// @@allow('all', true)
///
/// @namespace 設施設備修繕採購作業
///
/// 設備維修請求
model PropertyEquipmentMaintanceRecord {
  id                                 String                           @id() @default(uuid())
  createdAt                          DateTime                         @default(now())
  updatedAt                          DateTime                         @updatedAt()
  /// 預計維修日期
  scheduledDate                      DateTime
  /// 實際維修日期
  maintainanceDate                   DateTime
  /// 維修狀態: 完成 故障 (?)
  status                             String
  /// 屬於哪個資產
  propertyId                         String
  property                           Property                         @relation(fields: [propertyId], references: [id], onUpdate: NoAction, onDelete: NoAction)
  /// 屬於哪個廠商
  propertyEquipmentMaintanceVendorId String
  propertyEquipmentMaintanceVendor   PropertyEquipmentMaintanceVendor @relation(fields: [propertyEquipmentMaintanceVendorId], references: [id], onUpdate: NoAction, onDelete: NoAction)
}
